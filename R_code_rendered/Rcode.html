


<div id="ts-plot" class="section level3">
<h3>TS-plot</h3>
<p>Create TS-plots with isopycnals (as potential density) and dissolved oxygen concentration as the z-axis. This is an adaptation from this function</p>
<pre class="r"><code>ggTS &lt;- function(sal, abs.sal, temp, pot.temp, pres, reference.p = 0, col.par = NA, col.name = &quot;col.par&quot;) {
    # packages
    library(gsw)
    library(ggplot2)
    
    # make TS long table
    TSpd &lt;- expand.grid(abs.sal = seq(floor(min(abs.sal, na.rm = TRUE)), ceiling(max(abs.sal, na.rm = TRUE)), 
        length.out = 100), temp = seq(floor(min(temp, na.rm = TRUE)), ceiling(max(temp, na.rm = TRUE)), 
        length.out = 100), pres = seq(floor(min(pres, na.rm = TRUE)), ceiling(max(pres, na.rm = TRUE)), 
        length.out = 100))
    
    TS &lt;- expand.grid(sal = seq(floor(min(sal, na.rm = TRUE)), ceiling(max(sal, na.rm = TRUE)), length.out = 100), 
        pot.temp = seq(floor(min(pot.temp, na.rm = TRUE)), ceiling(max(pot.temp, na.rm = TRUE)), length.out = 100), 
        pres = seq(floor(min(pres, na.rm = TRUE)), ceiling(max(pres, na.rm = TRUE)), length.out = 100))
    
    TSpd$density &lt;- gsw_pot_rho_t_exact(SA = TSpd$abs.sal, t = TSpd$temp, p = TSpd$pres, p_ref = reference.p) - 
        1000
    density &lt;- TSpd$density
    TS$density &lt;- density
    
    h.isopycnals &lt;- subset(TS, TS$sal == ceiling(max(TS$sal)) &amp; round(TS$density, 1) %in% seq(min(round(TS$density * 
        2)/2, na.rm = TRUE), max(round(TS$density * 2)/2, na.rm = TRUE), by = 0.5))
    if (nrow(h.isopycnals) &gt; 0) {
        h.isopycnals$density &lt;- round(h.isopycnals$density, 1)
        h.isopycnals &lt;- aggregate(pot.temp ~ density, h.isopycnals, mean)
    }
    
    
    if (nrow(h.isopycnals) == 0) {
        rm(h.isopycnals)
        
        v.isopycnals &lt;- subset(TS, pot.temp == ceiling(max(TS$pot.temp)) &amp; round(TSpd$density, 1) %in% 
            seq(min(round(TS$density * 2)/2), max(round(TS$density * 2)/2), by = 0.5))
        v.isopycnals$density &lt;- round(v.isopycnals$density, 1)
        v.isopycnals &lt;- aggregate(sal ~ density, v.isopycnals, mean)
    }
    
    
    data &lt;- data.frame(sal, pot.temp, col.par)
    
    
    p1 &lt;- ggplot() + geom_contour(data = TS, aes(x = sal, y = pot.temp, z = density), col = &quot;grey&quot;, linetype = &quot;dashed&quot;, 
        breaks = seq(min(round(TS$density * 2)/2, na.rm = TRUE), max(round(TS$density * 2)/2, na.rm = TRUE), 
            by = 0.5)) + geom_point(data = data[is.na(data$col.par), ], aes(sal, pot.temp), color = &quot;black&quot;) + 
        geom_point(data = data[!is.na(data$col.par), ], aes(sal, pot.temp, color = col.par), size = 2.5) + 
        annotate(geom = &quot;text&quot;, x = floor(min(TS$sal, na.rm = TRUE)) + 0.6, y = ceiling(max(TS$pot.temp, 
            na.rm = TRUE)), hjust = &quot;inward&quot;, vjust = &quot;inward&quot;, color = &quot;grey60&quot;, size = 14, label = expression(italic(&quot;σ&quot;)[italic(&quot;θ&quot;)]), 
            parse = T) + scale_x_continuous(name = &quot;Practical Salinity [PSU]&quot;, expand = c(0, 0), limits = c(floor(min(TS$sal, 
        na.rm = TRUE)) + 0.5, ceiling(max(TS$sal, na.rm = TRUE)))) + scale_y_continuous(name = &quot;Potential Temperature [°C]&quot;, 
        expand = c(0, 0), limits = c(floor(min(TS$pot.temp, na.rm = TRUE)) + 0, ceiling(max(TS$pot.temp, 
            na.rm = TRUE)))) + scale_color_gradientn(colors = c(&quot;blue&quot;, &quot;green&quot;, &quot;yellow&quot;, &quot;red&quot;), name = col.name) + 
        theme_classic() + theme(text = element_text(size = 25))
    
    
    if (exists(&quot;h.isopycnals&quot;)) {
        p1 &lt;- p1 + geom_text(data = h.isopycnals, aes(x = ceiling(max(TS$sal)), y = pot.temp, label = density), 
            hjust = &quot;inward&quot;, vjust = -0.65, col = &quot;grey&quot;, size = 6)
    }
    
    
    if (exists(&quot;v.isopycnals&quot;)) {
        p1 &lt;- p1 + geom_text(data = v.isopycnals, aes(x = sal, y = ceiling(max(TS$pot.temp)), label = density), 
            vjust = &quot;inward&quot;, hjust = 0, col = &quot;grey&quot;, size = 6)
    }
    
    return(p1)
}</code></pre>
</div>

